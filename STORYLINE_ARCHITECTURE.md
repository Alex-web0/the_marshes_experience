# Storyline System Architecture Diagram

## Model Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      StorylineElement                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Properties:                                                â”‚  â”‚
â”‚  â”‚ â€¢ id: String                                               â”‚  â”‚
â”‚  â”‚ â€¢ title: String                                            â”‚  â”‚
â”‚  â”‚ â€¢ description: String                                      â”‚  â”‚
â”‚  â”‚ â€¢ startParagraphId: String                                 â”‚  â”‚
â”‚  â”‚ â€¢ triggerRequirements: Map<String, int>?                   â”‚  â”‚
â”‚  â”‚ â€¢ rewards: Map<String, int>?                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Contains â†“                            Contains â†“               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Map<String, Character> â”‚    â”‚  Map<String, Paragraph> â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â†“                                â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StoryCharacter     â”‚          â”‚     StoryParagraph       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ id           â”‚  â”‚          â”‚  â”‚ â€¢ id               â”‚  â”‚
â”‚  â”‚ â€¢ name         â”‚  â”‚          â”‚  â”‚ â€¢ text             â”‚  â”‚
â”‚  â”‚ â€¢ personality  â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ â€¢ characterId?     â”‚  â”‚
â”‚  â”‚ â€¢ imagePath    â”‚  â”‚ ref      â”‚  â”‚ â€¢ choices[]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Contains
                                              â†“
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚     StoryChoice          â”‚
                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                  â”‚  â”‚ â€¢ id               â”‚  â”‚
                                  â”‚  â”‚ â€¢ text             â”‚  â”‚
                                  â”‚  â”‚ â€¢ nextParagraphId  â”‚â”€â”€â”¼â”€â”
                                  â”‚  â”‚ â€¢ requirements?    â”‚  â”‚ â”‚
                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                               â”‚
                                         Links to â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         next paragraph

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        StoryProgress                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tracks player's journey through a story:                  â”‚  â”‚
â”‚  â”‚ â€¢ storyElementId: String                                   â”‚  â”‚
â”‚  â”‚ â€¢ currentParagraphId: String?                              â”‚  â”‚
â”‚  â”‚ â€¢ visitedParagraphs: List<String>                          â”‚  â”‚
â”‚  â”‚ â€¢ choicesMade: Map<String, String>                         â”‚  â”‚
â”‚  â”‚ â€¢ isCompleted: bool                                        â”‚  â”‚
â”‚  â”‚ â€¢ startedAt: int?                                          â”‚  â”‚
â”‚  â”‚ â€¢ completedAt: int?                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Game Engine  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ triggers story event
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StorylineRepository  â”‚ â† Singleton, manages all stories
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ loads story
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StorylineElement    â”‚ â† Complete story with characters & paragraphs
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ gets start paragraph
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StoryParagraph     â”‚ â† Current narrative segment
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ presents choices
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    StoryChoice       â”‚ â† Player selects
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ navigates to next
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StoryParagraph     â”‚ â† New narrative segment
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (repeat or end)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Story Complete      â”‚ â† Apply rewards, mark complete
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StoryProgress      â”‚ â† Track completion & path taken
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Example Story Structure

```
StorylineElement: "Old Fisherman Encounter"
â”‚
â”œâ”€ Characters:
â”‚  â””â”€ old_fisherman
â”‚     â”œâ”€ name: "Old Fisherman"
â”‚     â”œâ”€ personality: "Wise and weathered"
â”‚     â””â”€ imagePath: "old_fisherman.png"
â”‚
â”œâ”€ Paragraphs:
â”‚  â”‚
â”‚  â”œâ”€ intro (characterId: old_fisherman)
â”‚  â”‚  "You notice an old fisherman..."
â”‚  â”‚  Choices:
â”‚  â”‚  â”œâ”€ "approach" â†’ greeting
â”‚  â”‚  â””â”€ "ignore" â†’ ignored
â”‚  â”‚
â”‚  â”œâ”€ greeting (characterId: old_fisherman)
â”‚  â”‚  "Ah, a traveler!"
â”‚  â”‚  Choices:
â”‚  â”‚  â”œâ”€ "ask_advice" â†’ advice
â”‚  â”‚  â””â”€ "ask_story" â†’ marsh_lore
â”‚  â”‚
â”‚  â”œâ”€ advice (characterId: old_fisherman)
â”‚  â”‚  "The best spots are..."
â”‚  â”‚  Choices: [] (END)
â”‚  â”‚
â”‚  â”œâ”€ marsh_lore (characterId: old_fisherman)
â”‚  â”‚  "These marshes hold secrets..."
â”‚  â”‚  Choices: [] (END)
â”‚  â”‚
â”‚  â””â”€ ignored (characterId: null)
â”‚     "You continue on your way..."
â”‚     Choices: [] (END)
â”‚
â”œâ”€ startParagraphId: "intro"
â”‚
â”œâ”€ triggerRequirements:
â”‚  â””â”€ None (always available)
â”‚
â””â”€ rewards:
   â”œâ”€ score: 50
   â””â”€ storyCount: 1
```

## Player Path Examples

```
Path 1: Full Engagement
intro â†’ greeting â†’ advice
Result: Learn fishing tips, gain 50 points

Path 2: Lore Seeker  
intro â†’ greeting â†’ marsh_lore
Result: Learn marsh secrets, gain 50 points

Path 3: Antisocial
intro â†’ ignored
Result: Miss opportunity, still gain 50 points (for encountering)
```

## UI Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Game Screen                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Player navigates marshes    â”‚  â”‚
â”‚  â”‚   Story trigger activated     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      StorylineDialog Appears        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚  â”‚
â”‚  â”‚  â•‘ The Old Fisherman      â•‘   â”‚  â”‚
â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚      [Character Avatar]       â”‚  â”‚
â”‚  â”‚      Old Fisherman            â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  "You notice an old          â”‚  â”‚
â”‚  â”‚   fisherman sitting by       â”‚  â”‚
â”‚  â”‚   the river's edge..."       â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Approach the fisherman  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Keep moving             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Player clicks choice
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Dialog Updates to Next Para    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚  â”‚
â”‚  â”‚  â•‘ The Old Fisherman      â•‘   â”‚  â”‚
â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚      [Character Avatar]       â”‚  â”‚
â”‚  â”‚      Old Fisherman            â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  "Ah, a traveler! The        â”‚  â”‚
â”‚  â”‚   marshes have been kind     â”‚  â”‚
â”‚  â”‚   to you, I see..."          â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Ask for fishing advice  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Ask about the marshes   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Continues...
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Story Completes             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Rewards Applied:            â”‚  â”‚
â”‚  â”‚   âœ¨ +50 Score                â”‚  â”‚
â”‚  â”‚   ğŸ“– +1 Story                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           Dialog Closes             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Repository Management

```
StorylineRepository (Singleton)
â”‚
â”œâ”€ _storylineElements: Map<String, StorylineElement>
â”‚  â”œâ”€ "old_fisherman_quest" â†’ StorylineElement
â”‚  â”œâ”€ "marsh_guardian" â†’ StorylineElement
â”‚  â””â”€ "lost_child" â†’ StorylineElement
â”‚
â”œâ”€ _playerProgress: Map<String, StoryProgress>
â”‚  â”œâ”€ "old_fisherman_quest" â†’ StoryProgress (completed: true)
â”‚  â”œâ”€ "marsh_guardian" â†’ StoryProgress (completed: false, at para 3)
â”‚  â””â”€ "lost_child" â†’ (not started yet)
â”‚
â””â”€ Methods:
   â”œâ”€ getStorylineElement(id) â†’ StorylineElement?
   â”œâ”€ getAvailableStories(fishCount, storyCount) â†’ List<StorylineElement>
   â”œâ”€ startStory(id) â†’ StoryProgress
   â”œâ”€ makeChoice(...) â†’ StoryProgress
   â”œâ”€ completeStory(id) â†’ StoryProgress
   â”œâ”€ getProgress(id) â†’ StoryProgress?
   â””â”€ getCompletedStoriesCount() â†’ int
```

## State Machine

```
Story State Machine:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Idle   â”‚ No story active
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ trigger story
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Starting   â”‚ Load story, create progress
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presenting  â”‚ Show paragraph & choices
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ player makes choice
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigating  â”‚ Update progress, load next paragraph
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ Has more paragraphs? â†’ Back to Presenting
       â”‚
       â†“ No more paragraphs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Completing  â”‚ Apply rewards, mark complete
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Finished   â”‚ Close dialog, return to game
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Requirements & Rewards System

```
Story Gating (triggerRequirements):

Player Stats          Story Requirements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fishCount: 5â”‚â”€â”€â”€â”€â”€â”€â”‚ fishCount: 3     â”‚ âœ… PASS
â”‚ storyCount:2â”‚â”€â”€â”€â”€â”€â”€â”‚ storyCount: 1    â”‚ âœ… PASS
â”‚ score: 150  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      Story is available!


Player Stats          Story Requirements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fishCount: 1â”‚â”€â”€â”€â”€â”€â”€â”‚ fishCount: 5     â”‚ âŒ FAIL
â”‚ storyCount:0â”‚â”€â”€â”€â”€â”€â”€â”‚ storyCount: 2    â”‚ âŒ FAIL
â”‚ score: 20   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      Story is locked!


Reward Application:

Story Completion
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ rewards:         â”‚
â”‚ â€¢ score: 100     â”‚
â”‚ â€¢ fishCount: 2   â”‚
â”‚ â€¢ storyCount: 1  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Applied to
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Player Stats:    â”‚
â”‚ â€¢ score += 100   â”‚
â”‚ â€¢ fishCount += 2 â”‚
â”‚ â€¢ storyCount += 1â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Multiplayer Considerations

```
Single Player:
StorylineRepository (local)
    â†“
StoryProgress (local memory)
    â†“
Save to SharedPreferences


Multiplayer:
StorylineRepository (local)
    â†“
StoryProgress (local + Firebase sync)
    â†“
Broadcast to other players
    â†“
Other players see story state updates
```

## File Structure

```
lib/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ storyline_models.dart       â† All model classes
â”‚   â””â”€â”€ game_stats.dart             â† Player stats integration
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ storyline_repository.dart   â† Story management
â”‚   â””â”€â”€ heritage_repository.dart    â† High score integration
â”‚
â””â”€â”€ ui/
    â”œâ”€â”€ storyline_dialog.dart       â† Story UI component
    â””â”€â”€ game_over_menu.dart         â† Show completed stories

docs/
â”œâ”€â”€ STORYLINE_SYSTEM.md             â† Complete documentation
â””â”€â”€ STORY_CREATION_GUIDE.md         â† Quick start guide
```

## Integration Points

```
Game Engine (MarshesGame)
    â”‚
    â”œâ”€â†’ Detect story trigger
    â”‚   (position, fish count, etc.)
    â”‚
    â”œâ”€â†’ Query StorylineRepository
    â”‚   â€¢ getAvailableStories()
    â”‚   â€¢ Check player stats vs requirements
    â”‚
    â”œâ”€â†’ Show StorylineDialog
    â”‚   â€¢ Pass story ID
    â”‚   â€¢ Handle completion callback
    â”‚
    â””â”€â†’ Apply rewards
        â€¢ Update GameStats
        â€¢ Sync to Firebase (multiplayer)
        â€¢ Save to SharedPreferences
```

---

This diagram provides a visual reference for understanding how all the components of the storyline system work together!
